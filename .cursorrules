# Reglas del Proyecto - Caba√±as Los Manzanos

## üì¶ Al finalizar cualquier feature o cambio:

### Versionado (Semantic Versioning)

-   SIEMPRE actualizar la versi√≥n en `package.json` seg√∫n el tipo de cambio:
    -   **Major (X.0.0)**: Cambios que rompen compatibilidad
    -   **Minor (0.X.0)**: Nuevas features
    -   **Patch (0.0.X)**: Bugfixes y mejoras menores

### CHANGELOG

-   Agregar entrada en `CHANGELOG.md` con:
    -   Versi√≥n nueva
    -   Fecha (formato: YYYY-MM-DD)
    -   Descripci√≥n detallada de los cambios
    -   Tipo de cambio:
        -   ‚ú® **Nuevo Feature** / **Added**
        -   üêõ **Corregido** / **Fixed**
        -   üé® **Mejorado** / **Changed**
        -   üóëÔ∏è **Removido** / **Removed**
    -   Explicar CAUSA del problema (si es fix)
    -   Mostrar ejemplos de c√≥digo antes/despu√©s cuando sea relevante

---

## üõ†Ô∏è Stack Tecnol√≥gico

### Frontend

-   **Framework**: Next.js 16 (App Router)
-   **Lenguaje**: TypeScript
-   **Estilos**: Tailwind CSS 4
-   **Componentes**: shadcn/ui
-   **Formularios**: React Hook Form + Zod
-   **Fechas**: date-fns (con locale es)
-   **Iconos**: lucide-react

### Backend

-   **API**: Next.js API Routes
-   **Base de Datos**: MongoDB con Mongoose
-   **Notificaciones**: WhatsApp (API de WhatsApp Web)

### Integraciones

-   **n8n**: Automatizaci√≥n y actualizaci√≥n de Excel

---

## üìù Convenciones de C√≥digo

### TypeScript

-   **NO usar punto y coma** al final de las l√≠neas
-   Usar **comillas simples** (`'`) en lugar de comillas dobles
-   Preferir **arrow functions** para componentes funcionales
-   Usar **tipos expl√≠citos** cuando sea necesario para claridad
-   Evitar `any`, usar `unknown` y hacer type guards

### Formato

```typescript
// ‚úÖ CORRECTO
import { useState } from 'react'

const Component = () => {
    const [state, setState] = useState<string>('')
    return <div>{state}</div>
}

// ‚ùå INCORRECTO
import { useState } from 'react'

const Component = () => {
    const [state, setState] = useState<string>('')
    return <div>{state}</div>
}
```

### Nombres

-   **Componentes**: PascalCase (`ReservaForm`, `EmailTemplate`)
-   **Archivos de componentes**: PascalCase (`ReservaForm.tsx`)
-   **Utilidades/hooks**: camelCase (`useReservas`, `formatDate`)
-   **Archivos de utilidades**: camelCase (`mongodb.ts`, `email.ts`)
-   **Constantes**: UPPER_SNAKE_CASE (`MAX_RESERVAS`, `DEFAULT_PORT`)
-   **Variables**: camelCase en espa√±ol (`nombreCompleto`, `fechaInicio`)

### Estructura de Archivos

```
app/
  ‚îú‚îÄ‚îÄ api/              # API Routes
  ‚îú‚îÄ‚îÄ (rutas)/          # P√°ginas y layouts
  ‚îî‚îÄ‚îÄ globals.css       # Estilos globales

components/
  ‚îú‚îÄ‚îÄ forms/            # Formularios
  ‚îú‚îÄ‚îÄ ui/               # Componentes de shadcn/ui
  ‚îî‚îÄ‚îÄ shared/           # Componentes compartidos

lib/
  ‚îú‚îÄ‚îÄ mongodb.ts        # Conexi√≥n DB
  ‚îú‚îÄ‚îÄ auth.ts           # Utilidades de autenticaci√≥n
  ‚îú‚îÄ‚îÄ dolar.ts          # Cotizaci√≥n d√≥lar
  ‚îú‚îÄ‚îÄ schemas.ts        # Schemas de validaci√≥n
  ‚îî‚îÄ‚îÄ utils.ts          # Utilidades generales

models/
  ‚îî‚îÄ‚îÄ Reserva.ts        # Modelos de Mongoose
```

---

## üóÑÔ∏è Base de Datos

### MongoDB

-   **Base de Datos Local**: `mongodb://localhost:27017/manzanos-cabins`
-   **Producci√≥n**: MongoDB Atlas (configurar en `.env.local`)

### Modelos

-   Usar **Mongoose** para todos los modelos
-   Definir **interfaces TypeScript** para todos los documentos
-   Usar **middlewares** de Mongoose para c√°lculos autom√°ticos
-   Validar datos tanto en **Zod** (frontend) como en **Mongoose** (backend)

### Ejemplo de Modelo

```typescript
export interface IReserva extends Document {
    nombreCompleto: string
    // ... campos
}

const Schema = new Schema({
    nombreCompleto: {
        type: String,
        required: [true, 'Mensaje de error']
    }
})

// Middleware para c√°lculos
Schema.pre('save', function (this: IReserva) {
    this.saldoPendiente = this.costoTotal - this.sena
})
```

---

## üì± Sistema de Notificaciones WhatsApp

### Configuraci√≥n

-   Campo `telefono` opcional en formulario de reserva
-   Validaci√≥n: Solo n√∫meros permitidos
-   Formato internacional recomendado: `5491123456789` (pa√≠s + √°rea + n√∫mero)

### Funcionalidad

-   **Bot√≥n en SuccessBanner**: Env√≠a mensaje preformateado con link a reserva
-   **Bot√≥n en UltimasReservas**: √çcono WhatsApp para reenviar confirmaci√≥n
-   **Mensaje personalizado**: Saludo por nombre + link p√∫blico a reserva
-   **P√°gina p√∫blica**: `/reserva/[id]` - No requiere autenticaci√≥n

### Ejemplo de Mensaje

```
Hola Juan! üëã

Te confirmamos que registramos tu reserva en el sistema de *Caba√±as Los Manzanos*. üè°

Pod√©s verificar todos los detalles de tu estad√≠a en el siguiente link:
https://tudominio.com/reserva/507f1f77bcf86cd799439011

¬°Te esperamos en San Mart√≠n de los Andes! üèîÔ∏è
```

---

## üé® Dise√±o y UX

### Paleta de Colores

-   **Primario**: Tonos tierra/madera (`stone-700`, `stone-800`)
-   **Acento**: √Åmbar c√°lido (`amber-300`, `amber-50`)
-   **Fondos**: Stone claro (`stone-50`, `stone-100`)

### Principios

-   **Elegancia**: Reflejar la calidez de las caba√±as
-   **Claridad**: Informaci√≥n f√°cil de entender
-   **Responsive**: Mobile-first, funcional en todos los dispositivos
-   **Accesibilidad**: Contraste adecuado, labels descriptivos

### Componentes shadcn/ui

-   Usar componentes de `components/ui/`
-   Customizar colores con variables CSS en `globals.css`
-   Mantener consistencia visual en toda la app

### Interactividad

-   **TODOS los botones, links y elementos clickeables DEBEN tener `cursor-pointer`**
-   Usar estados hover para feedback visual
-   Transiciones suaves con `transition-colors` o `transition-all`

```tsx
// ‚úÖ CORRECTO
<button className="bg-stone-600 hover:bg-stone-700 cursor-pointer">Click</button>
<Link href="/gestion" className="text-blue-600 hover:text-blue-800 cursor-pointer">
    Link
</Link>

// ‚ùå INCORRECTO - Falta cursor-pointer
<button className="bg-stone-600 hover:bg-stone-700">Click</button>
```

---

## üîê Seguridad

### Variables de Entorno

-   **NUNCA** commitear `.env.local`
-   Mantener `.env.example` actualizado como referencia
-   Validar variables de entorno al inicio de la app

### Validaci√≥n

-   **Frontend**: Validaci√≥n con Zod en formularios
-   **Backend**: Validaci√≥n con Zod + Mongoose
-   **Doble validaci√≥n**: Nunca confiar solo en frontend

### API Routes

-   Manejar errores apropiadamente
-   **No exponer** informaci√≥n sensible en respuestas de error
-   Usar c√≥digos HTTP correctos (200, 201, 400, 500)

---

## üß™ Testing (Futuro)

### Cuando se implemente testing:

-   **Unit tests**: Para funciones puras y utilidades
-   **Integration tests**: Para API routes
-   **E2E tests**: Para flujos cr√≠ticos (crear reserva)
-   Usar **Jest** + **React Testing Library**

---

## üöÄ Deployment

### Preparaci√≥n

```bash
# 1. Verificar build local
npm run build

# 2. Probar en producci√≥n local
npm run start

# 3. Verificar variables de entorno
```

### Plataformas Recomendadas

-   **Vercel** (preferido para Next.js)
-   Railway, Render, AWS, Digital Ocean

### Variables de Entorno en Producci√≥n

-   Configurar todas las variables necesarias:
    -   `MONGODB_URI`: Base de datos (MongoDB Atlas recomendado)
    -   `AUTH_USERNAME` y `AUTH_PASSWORD`: Credenciales de login
    -   `N8N_WEBHOOK_URL`: Webhook de n8n (opcional)

---

## üîÑ Integraci√≥n n8n

### Objetivo

-   Escuchar creaci√≥n de nuevas reservas
-   Actualizar Excel autom√°ticamente en Google Sheets
-   Realizar conversi√≥n ARS ‚Üí USD
-   Organizar por a√±o en sheets din√°micos

### Configuraci√≥n

-   Webhook URL configurada en `.env.local`
-   Endpoint: `POST /api/reservas` env√≠a datos a n8n
-   Respuesta incluye todos los datos necesarios
-   Timezone: `America/Buenos_Aires`

---

## üìä Buenas Pr√°cticas Generales

### Git

-   **Commits descriptivos** en espa√±ol
-   Formato: `tipo: descripci√≥n`
    -   `feat:` nueva funcionalidad
    -   `fix:` correcci√≥n de bug
    -   `style:` cambios de formato
    -   `refactor:` refactorizaci√≥n
    -   `docs:` documentaci√≥n
    -   `chore:` tareas de mantenimiento

### C√≥digo

-   **DRY** (Don't Repeat Yourself): Extraer l√≥gica com√∫n
-   **Nombres descriptivos**: Claridad sobre brevedad
-   **Comentarios** solo cuando la l√≥gica es compleja
-   **Funciones peque√±as**: Una responsabilidad por funci√≥n

### Performance

-   Usar **React.memo** cuando sea necesario
-   Optimizar im√°genes antes de agregar
-   Lazy loading para rutas no cr√≠ticas
-   Minimizar bundle size

---

## üéØ Contexto del Proyecto

### Usuario Final

-   Madre del desarrollador
-   Gestiona 2 caba√±as en San Mart√≠n de los Andes
-   Necesita simplicidad y claridad

### Funcionalidad Core

1. **Crear reservas** con formulario simple
2. **C√°lculos autom√°ticos** (saldo, d√≠as, descuentos)
3. **Notificaci√≥n por WhatsApp** con link a p√°gina p√∫blica
4. **Gesti√≥n de estado de pago** (pendiente/pagado)
5. **Integraci√≥n con n8n** para actualizar Excel autom√°ticamente

### Prioridades

1. **Simplicidad**: F√°cil de usar
2. **Confiabilidad**: No perder datos
3. **Automatizaci√≥n**: Menos trabajo manual
4. **Est√©tica**: Reflejar calidad de las caba√±as

---

## üìû Mantenimiento

### Logs

-   Revisar logs de producci√≥n regularmente
-   Monitorear errores en API routes
-   Verificar conexi√≥n a MongoDB
-   Verificar integraci√≥n con n8n

### Backups

-   MongoDB: Configurar backups autom√°ticos en Atlas
-   C√≥digo: Git + repositorio remoto

### Actualizaciones

-   Mantener dependencias actualizadas
-   Probar en local antes de deploy
-   Documentar breaking changes en CHANGELOG
